<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Data Display</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;

    }

    th,
    td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      white-space: normal;
      word-break: break-all;
      overflow-wrap: break-word;
    }

    th {
      background-color: #f2f2f2;
    }

    /* 各列の幅を調整 */
    td:nth-child(1),
    th:nth-child(1) {
      width: fit-content;
      /* ID列 */
    }

    td:nth-child(2),
    th:nth-child(2) {
      width: 20%;
      /* Title列 */
    }

    td:nth-child(3),
    th:nth-child(3) {
      width: 30%;
      /* Description列 */
    }

    td:nth-child(4),
    th:nth-child(4) {
      width: 20%;
      /* URL列 */
    }

    td:nth-child(5),
    th:nth-child(5) {
      width: 12%;
      /* Category列 */
    }

    td:nth-child(6),
    th:nth-child(6) {
      width: auto;
      /* Kind列 */
    }

    a {
      display: block;
      max-height: 4.5em;
      overflow-y: auto;
    }

    .sorted-asc::after {
      content: "▲";
      /* 昇順のマーク */
    }

    .sorted-desc::after {
      content: "▼";
      /* 降順のマーク */
    }
  </style>
</head>

<body>
  <h1>JSON Data Display</h1>
  <table>
    <thead>
      <tr>
        <th class="sortable" onclick="sortTable('id')">ID</th>
        <th class="sortable" onclick="sortTable('title')">Title</th>
        <th class="sortable" onclick="sortTable('description')">Description</th>
        <th class="sortable" onclick="sortTable('url')">URL</th>
        <th class="sortable" onclick="sortTable('category')">Category</th>
        <th class="sortable" onclick="sortTable('kind')">Kind</th>
      </tr>
    </thead>
    <tbody id="dataBody"></tbody>
  </table>
  <script>
    function fetchData() {
      fetch('iroiro.json')
        .then(response => response.json())
        .then(data => {
          const dataBody = document.getElementById('dataBody');
          let id = 0;
          for (const key in data) {
            if (Object.hasOwnProperty.call(data, key)) {
              const item = data[key];
              const row = document.createElement('tr');
              const idCell = document.createElement('td');
              idCell.textContent = key; // データの番号を表示
              const description = item.description.replace(/\n/g, '<br>');
              row.innerHTML = `
                <td>${key}</td>
                <td>${item.title}</td>
                <td>${description}</td>
                <td><a href="${item.url}" target="_blank" rel="external noreferrer" >${item.url}</a></td>
                <td>${item.category}</td>
                <td>${item.kind ?? ''}</td>
              `;
              dataBody.appendChild(row);
              id++;
            }
          }
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    window.onload = fetchData;

    function sortTable(columnName) {
      const table = document.querySelector('table');
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      const isAscending = rows[0].querySelectorAll('td')[columnName === 'id' ? 0 : Array.from(table.querySelectorAll('thead th')).findIndex(th => th.textContent.toLowerCase() === columnName)].textContent > rows[1].querySelectorAll('td')[columnName === 'id' ? 0 : Array.from(table.querySelectorAll('thead th')).findIndex(th => th.textContent.toLowerCase() === columnName)].textContent;

      rows.sort((a, b) => {
        const aValue = columnName === 'id' ? parseInt(a.querySelectorAll('td')[0].textContent) : columnName === 'kind' ? parseInt(a.querySelectorAll('td')[Array.from(table.querySelectorAll('thead th')).findIndex(th => th.textContent.toLowerCase() === columnName)].textContent) : a.querySelectorAll('td')[Array.from(table.querySelectorAll('thead th')).findIndex(th => th.textContent.toLowerCase() === columnName)].textContent;
        const bValue = columnName === 'id' ? parseInt(b.querySelectorAll('td')[0].textContent) : columnName === 'kind' ? parseInt(b.querySelectorAll('td')[Array.from(table.querySelectorAll('thead th')).findIndex(th => th.textContent.toLowerCase() === columnName)].textContent) : b.querySelectorAll('td')[Array.from(table.querySelectorAll('thead th')).findIndex(th => th.textContent.toLowerCase() === columnName)].textContent;
        return isAscending ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
      });

      while (tbody.firstChild) {
        tbody.removeChild(tbody.firstChild);
      }

      rows.forEach(row => {
        tbody.appendChild(row);
      });

      // ソートされた列のヘッダーにマークを付ける
      const headers = table.querySelectorAll('th');
      headers.forEach(header => {
        header.classList.remove('sorted-asc', 'sorted-desc');
      });
      const currentHeader = headers[Array.from(table.querySelectorAll('thead th')).findIndex(th => th.textContent.toLowerCase() === columnName)];
      if (isAscending) {
        currentHeader.classList.add('sorted-asc');
      } else {
        currentHeader.classList.add('sorted-desc');
      }
    }

  </script>
</body>

</html>